<!DOCTYPE html>
<html>

<head>
    <title>Maze</title>
    <script src="graphics.js" type="text/javascript"></script>
    <script src="item.js" type="text/javascript"></script>
    <script src="maze.js" type="text/javascript"></script>
    <script src="controller.js" type="text/javascript"></script>
    <script src="algorithms.js" type="text/javascript"></script>
    <script src="factory.js" type="text/javascript"></script>
    <script src="config.js" type="text/javascript"></script>
</head>

<body>
    <canvas id="canvas" width="600" height="600"></canvas>
</body>


<script type="text/javascript">
    const start = async () => {
        const maze = new Maze();

        const factory = new Factory();

        await maze.init(Config.MAZE_WIDTH, Config.MAZE_HEIGHT, (i, j) => factory.newFloorItem(i, j));

        const canvas = document.getElementById('canvas');
        const canvas2DCtx = canvas.getContext('2d');

        const mazeToCanvasPrinter = new MazeToCanvasPrinter(canvas2DCtx, Config.CANVAS_WIDTH, Config.CANVAS_HEIGHT, Config.MAZE_WIDTH, Config.MAZE_HEIGHT);

        Algorithms.initializeWalls(maze, 0.1, (i, j) => factory.newTreeItem(i, j));

        const controlItem = factory.newDwarfItem(3, 7);
        maze.place(controlItem);
        new MangedItemController(maze, canvas, Config.CANVAS_WIDTH, Config.CANVAS_HEIGHT, Config.ACTIONS_INTERVAL, controlItem);

        setTimeout(() => {
            const enemyItem = factory.newBanditItem(15, 15);
            maze.place(enemyItem);
            new EnemyController(maze, canvas, Config.CANVAS_WIDTH, Config.CANVAS_HEIGHT, Config.ACTIONS_INTERVAL, enemyItem, controlItem);
        }, 500);

        setInterval(() => {
            canvas2DCtx.clearRect(0, 0, Config.CANVAS_WIDTH, Config.CANVAS_HEIGHT);
            mazeToCanvasPrinter.print(maze);
        }, Config.RERENDER_INTERVAL);
    };

    start();

</script>

</html>
<!DOCTYPE html>
<html>

<head>
    <title>Maze</title>
    <script src="graphics.js" type="text/javascript"></script>
    <script src="algorithms.js" type="text/javascript"></script>
    <script src="item.js" type="text/javascript"></script>
    <script src="maze.js" type="text/javascript"></script>
    <script src="controller.js" type="text/javascript"></script>
</head>

<body>
    <canvas id="canvas" width="600" height="600"></canvas>
</body>


<script type="text/javascript">
    const CANVAS_WIDTH = 600;
    const CANVAS_HEIGHT = 600;
    const MAZE_WIDTH = 40;
    const MAZE_HEIGHT = 40;
    const RERENDER_INTERVAL = 200;
    const ACTIONS_INTERVAL = 400;

    var itemsCounter = 0;

    const maze = new Maze();
    maze.init(MAZE_WIDTH, MAZE_HEIGHT, (i, j) => new ItemSymbol(itemsCounter++, i, j, '0'));

    const canvas = document.getElementById('canvas');
    const canvas2DCtx = canvas.getContext('2d');

    const mazeToCanvasPrinter = new MazeToCanvasPrinter(canvas2DCtx, CANVAS_WIDTH, CANVAS_HEIGHT);

    const controlItem = new ItemWithControl(itemsCounter++, 3, 7, maze);
    maze.place(controlItem);

    document.addEventListener('keydown', event => {
        if (event.keyCode == 37) {  
            controlItem.moveLeft();
        }
        else if (event.keyCode == 39) {        
            controlItem.moveRight();
        }
        if (event.keyCode == 38) {  
            controlItem.moveUp();
        }
        else if (event.keyCode == 40) {        
            controlItem.moveDown();
        }
    });

    const algorithms = new Algorithms(maze, (i, j) => new ItemSymbol(itemsCounter++, i, j, 'W', false));
    algorithms.initializeWalls(0.1);

    const controller = new AbstractController(maze, canvas, CANVAS_WIDTH, CANVAS_HEIGHT, ACTIONS_INTERVAL);

    setInterval(() => {
        canvas2DCtx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
        mazeToCanvasPrinter.print(maze);
    }, RERENDER_INTERVAL);
</script>

</html>
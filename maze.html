<!DOCTYPE html>
<html>

<head>
    <title>Maze</title>
    <script src="graphics.js" type="text/javascript"></script>
    <script src="item.js" type="text/javascript"></script>
    <script src="maze.js" type="text/javascript"></script>
    <script src="controller.js" type="text/javascript"></script>
    <script src="algorithms.js" type="text/javascript"></script>
</head>

<body>
    <canvas id="canvas" width="600" height="600"></canvas>
</body>


<script type="text/javascript">
    const MAZE_WIDTH = 40;
    const MAZE_HEIGHT = 40;
    const CANVAS_WIDTH = MAZE_WIDTH * 25;
    const CANVAS_HEIGHT = MAZE_HEIGHT * 25;
    const RERENDER_INTERVAL = 200;
    const ACTIONS_INTERVAL = 400;
    const PERSON_SIZE = 40;
    const BG_SIZE = 35;

    var itemsCounter = 0;

    const start = async () => {
        const maze = new Maze();

        const loadImage = file => {
            const img = new Image();
            img.src = file;
            return img;
        }

        const treeImage = loadImage("forest.png");
        await maze.init(MAZE_WIDTH, MAZE_HEIGHT, (i, j) => new ItemWithSprite(itemsCounter++, i, j, true, treeImage, 20, 20, 680, 680, BG_SIZE, BG_SIZE));

        const canvas = document.getElementById('canvas');
        const canvas2DCtx = canvas.getContext('2d');

        const mazeToCanvasPrinter = new MazeToCanvasPrinter(canvas2DCtx, CANVAS_WIDTH, CANVAS_HEIGHT, MAZE_WIDTH, MAZE_HEIGHT);

        Algorithms.initializeWalls(maze, 0.1, (i, j) => new ItemWithSprite(itemsCounter++, i, j, false, treeImage, 65, 65, 924, 159, 60, 60));

        const controlItem = new ItemWithControl(itemsCounter++, 3, 7, maze, loadImage("hero.png"), 70, 70, 0, 0, PERSON_SIZE, PERSON_SIZE);
        maze.place(controlItem);
        new MangedItemController(maze, canvas, CANVAS_WIDTH, CANVAS_HEIGHT, ACTIONS_INTERVAL, controlItem);

        setTimeout(() => {
            const enemyItem = new ItemWithSprite(itemsCounter++, 15, 15, false, loadImage("bandit.png"), 80, 120, 23, 10, PERSON_SIZE, PERSON_SIZE);
            maze.place(enemyItem);
            new EnemyController(maze, canvas, CANVAS_WIDTH, CANVAS_HEIGHT, ACTIONS_INTERVAL, enemyItem, controlItem);
        }, 500);

        setInterval(() => {
            canvas2DCtx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
            mazeToCanvasPrinter.print(maze);
        }, RERENDER_INTERVAL);
    };

    start();

</script>

</html>